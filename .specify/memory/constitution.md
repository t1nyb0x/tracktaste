# TrackTaste Constitution

## Core Principles

### I. モジュラーアーキテクチャ

すべての機能は独立したパッケージとして実装する：

- 各パッケージは単一責任の原則に従う
- 独立してテスト可能である
- 明確なインターフェースとドキュメントを持つ
- 音楽データ処理、API 連携、レコメンドエンジンなど明確な目的がある
- internal/パッケージで内部実装を隠蔽

### II. CLI インターフェース

すべてのモジュールは CLI 経由で機能を公開：

- テキスト入出力プロトコル：stdin/args → stdout、エラー → stderr
- JSON + 人間が読める形式の両方をサポート
- パイプライン処理が可能な設計
- cobra/viper 等の標準的な CLI ライブラリを活用

### III. テストファースト開発（交渉不可）

TDD 必須：テスト作成 → ユーザー承認 → テスト失敗確認 → 実装

- Red-Green-Refactor サイクルを厳守
- すべての機能にユニットテストが必須（testing パッケージ）
- テストカバレッジ 90%以上を維持
- テーブル駆動テストを推奨

### IV. 統合テスト戦略

以下の領域で統合テストが必須：

- 新しいライブラリの契約テスト
- API 連携（Spotify、Last.fm 等）の動作確認（httptest 使用）
- 推薦エンジンのエンドツーエンドテスト

### V. 観測可能性・バージョニング・シンプルさ

- テキスト I/O でデバッグ可能性を確保
- 構造化ログ必須（slog 標準パッケージ使用）
- MAJOR.MINOR.PATCH 形式のセマンティックバージョニング
- YAGNI 原則に従い、シンプルさを優先
- Go の慣用的コード（idiomatic Go）を厳守

## セキュリティとプライバシー

- ユーザー認証情報と API キーは環境変数で管理
- 個人の音楽嗜好データは暗号化保存（crypto 標準パッケージ）
- GDPR 準拠：データ削除・エクスポート機能
- 依存関係の定期的なセキュリティ監査（govulncheck 使用）

## 技術スタックと品質基準

**必須技術：**

- Go 1.21 以上
- 標準ライブラリ優先、外部依存は最小限に
- testing + testify（アサーション）
- golangci-lint（静的解析・リント）

**コーディング規約：**

- gofmt/goimports 適用必須
- golangci-lint 全チェック合格
- エラーハンドリング：errors.Is/As 使用、wrapping 推奨
- context.Context を第一引数として渡す

**パフォーマンス基準：**

- 推薦生成：3 秒以内
- API 応答：500ms 以内
- ゴルーチンリーク防止（context 使用）

## Governance

憲法はすべての開発プラクティスに優先する：

- すべての PR/レビューでコンプライアンス確認必須
- 憲法の改正には明確な理由、承認、移行計画が必要
- 複雑性の導入には正当化が必要
- `.specify/memory/guidance.md`を開発時の実行ガイダンスとして参照
- Effective Go とコードレビューコメント集を参考にする

**Version**: 1.0.0 | **Ratified**: 2025-11-24 | **Last Amended**: 2025-11-24
